# ğŸ¬ Mini-Advertisement

<div align="center">

ä¸€ä¸ªè½»é‡çº§çš„å¹¿å‘Šç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè§†é¢‘å¹¿å‘Šå±•ç¤ºã€åŠ¨æ€è¡¨å•é…ç½®å’Œæ™ºèƒ½æ’åº

[![TypeScript](https://img.shields.io/badge/TypeScript-5.9.3-blue?logo=typescript)](https://www.typescriptlang.org/)
[![React](https://img.shields.io/badge/React-18.3.1-61dafb?logo=react)](https://react.dev/)
[![Vite](https://img.shields.io/badge/Vite-7.2.4-646cff?logo=vite)](https://vitejs.dev/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

[åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [æŠ€æœ¯æ ˆ](#-æŠ€æœ¯æ ˆ) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„) â€¢ [æ ¸å¿ƒäº®ç‚¹](#-æ ¸å¿ƒäº®ç‚¹)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Mini-Advertisement æ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„å¹¿å‘Šç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·ç‚¹å‡»å¹¿å‘Šåä¼šå…ˆè§‚çœ‹è§†é¢‘ï¼Œéšåè·³è½¬åˆ°è½åœ°é¡µå¹¶ç»Ÿè®¡ç‚¹å‡»é‡ã€‚ç³»ç»Ÿé‡‡ç”¨åŠ¨æ€è¡¨å•é…ç½®ï¼Œæ”¯æŒåç«¯æ§åˆ¶å‰ç«¯è¡¨å•ç»“æ„ï¼Œå…·å¤‡é«˜åº¦çš„å¯æ‰©å±•æ€§ã€‚

FEä»“åº“:https://github.com/jet-isnt-haha/mini-advertisement

FEå¯è®¿é—®åŸŸå:[mini-advertisement.vercel.app](https://mini-advertisement.vercel.app/)

BEä»“åº“:https://github.com/jet-isnt-haha/mini-advertisement-BE

BEå¯è®¿é—®åŸŸå:[mini-advertisement-be.onrender](https://mini-advertisement-be.onrender.com)

å¼€å‘æ–‡æ¡£: [å¼€å‘æ–‡æ¡£](./docs/DEVELOPMENT.md)

### âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ“ **å¹¿å‘Šç®¡ç†** - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤å¹¿å‘Šï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ
- ğŸ¬ **è§†é¢‘æ’­æ”¾** - æ”¯æŒå¤šè§†é¢‘ä¸Šä¼ ï¼Œéšæœºæ’­æ”¾åè‡ªåŠ¨è·³è½¬
- ğŸ“Š **æ•°æ®ç»Ÿè®¡** - å®æ—¶è®°å½•å¹¿å‘Šç‚¹å‡»é‡
- ğŸ† **æ™ºèƒ½æ’åº** - åŸºäºå‡ºä»·å’Œç‚¹å‡»é‡çš„åŠ æƒæ’åºç®—æ³•
- âš™ï¸ **åŠ¨æ€è¡¨å•** - åç«¯é…ç½®é©±åŠ¨çš„è¡¨å•æ¸²æŸ“ç³»ç»Ÿ
- ğŸš€ **æ‰¹é‡ä¸Šä¼ ** - æ–‡ä»¶æ‰¹é‡ä¸Šä¼ ä¼˜åŒ–ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚

---

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯

| æŠ€æœ¯        | ç‰ˆæœ¬    | è¯´æ˜               |
| ----------- | ------- | ------------------ |
| React       | 18.3.1  | ç”¨æˆ·ç•Œé¢æ„å»º       |
| TypeScript  | 5.9.3   | ç±»å‹å®‰å…¨           |
| Vite        | 7.2.4   | æ„å»ºå·¥å…·           |
| Arco Design | 2.66. 8 | UI ç»„ä»¶åº“          |
| Axios       | 1.13.2  | HTTP è¯·æ±‚          |
| ahooks      | 3.9.6   | React Hooks å·¥å…·åº“ |

### åç«¯

| æŠ€æœ¯       | ç‰ˆæœ¬     | è¯´æ˜         |
| ---------- | -------- | ------------ |
| Node.js    | â‰¥14.0. 0 | è¿è¡Œç¯å¢ƒ     |
| Express    | 4.17.1   | Web æ¡†æ¶     |
| TypeScript | 4.5.4    | ç±»å‹å®‰å…¨     |
| Multer     | 2.0.2    | æ–‡ä»¶ä¸Šä¼ å¤„ç† |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 14.0.0
- pnpm >= 10.9.0

### å®‰è£…ä¸è¿è¡Œ

#### 1ï¸âƒ£ å…‹éš†é¡¹ç›®

```bash
git clone git@github.com:jet-isnt-haha/mini-advertisement.git
cd mini-advertisement

git clone git@github.com:jet-isnt-haha/mini-advertisement-BE.git
cd mini-advertisement-BE
```

#### 2ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
# å®‰è£…å‰ç«¯/åç«¯ä¾èµ–
pnpm install

```

#### 3ï¸âƒ£ å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨å‰ç«¯ï¼ˆç«¯å£ 5173ï¼‰
pnpm dev

# å¯åŠ¨åç«¯ï¼ˆç«¯å£ 3000ï¼‰
pnpm dev
```

#### 4ï¸âƒ£ è®¿é—®åº”ç”¨

- å‰ç«¯ï¼šhttp://localhost:5173
- åç«¯ APIï¼šhttp://localhost:3000

### ç”Ÿäº§æ„å»º

```bash
# æ„å»ºå‰ç«¯
pnpm build

# é¢„è§ˆæ„å»ºç»“æœ
pnpm preview
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

### å‰ç«¯ç»“æ„

```
src/
â”œâ”€â”€ apis/                   # API æ¥å£å±‚
â”‚   â””â”€â”€ index.ts           # æ‰€æœ‰ API è¯·æ±‚
â”œâ”€â”€ components/            # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ AdCard/           # å¹¿å‘Šå¡ç‰‡
â”‚   â”œâ”€â”€ AdOperator/       # å¹¿å‘Šç¼–è¾‘å™¨ï¼ˆåŠ¨æ€è¡¨å•ï¼‰
â”‚   â””â”€â”€ VideoPlayer/      # è§†é¢‘æ’­æ”¾å™¨
â”œâ”€â”€ contexts/             # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ AdOperator/       # å¹¿å‘Šæ“ä½œ Context
â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰ Hooks
â”‚   â””â”€â”€ useAdClickFlow.ts # ç‚¹å‡»æµç¨‹æ§åˆ¶
â”œâ”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â””â”€â”€ Home. tsx          # é¦–é¡µ
â”œâ”€â”€ routes/               # è·¯ç”±é…ç½®
â”œâ”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ entity.ts         # å®ä½“ç±»å‹
â”‚   â””â”€â”€ form.ts           # è¡¨å•ç±»å‹
â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
    â”œâ”€â”€ navigateByUrl.ts      # è·³è½¬è¾…åŠ©
    â”œâ”€â”€ processorHelper.ts    # æ•°æ®å¤„ç†ç®¡é“
    â”œâ”€â”€ uploadFileHelper.ts   # æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–
    â””â”€â”€ requestHelper.ts      # è¯·æ±‚å°è£…
```

### åç«¯ç»“æ„

```
server/src/
â”œâ”€â”€ app.ts                      # Express åº”ç”¨å…¥å£
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ AdFormConfig.ts         # åŠ¨æ€è¡¨å•é…ç½®
â”œâ”€â”€ controllers/                # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ advertise.controller.ts # å¹¿å‘Šæ¥å£æ§åˆ¶å™¨
â”‚   â””â”€â”€ upload.controller.ts    # æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨
â”œâ”€â”€ routes/                     # è·¯ç”±å±‚
â”‚   â”œâ”€â”€ advertise.route.ts      # å¹¿å‘Šè·¯ç”±
â”‚   â””â”€â”€ upload. route.ts         # ä¸Šä¼ è·¯ç”±
â”œâ”€â”€ services/                   # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â””â”€â”€ advertise.services.ts   # å¹¿å‘Š CRUD ä¸æ’åº
â”œâ”€â”€ middlewares/                # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ upload.middleware.ts    # Multer æ–‡ä»¶ä¸Šä¼ 
â”‚   â””â”€â”€ validator.middleware.ts # å‚æ•°æ ¡éªŒ
â””â”€â”€ utils/                      # å·¥å…·å‡½æ•°
    â”œâ”€â”€ dataHelper.ts           # JSON æ•°æ®è¯»å†™
    â”œâ”€â”€ rankHelper.ts           # æ’åºç®—æ³•
    â””â”€â”€ validator.ts            # æ•°æ®éªŒè¯
```

---

## ğŸ’¡ æ ¸å¿ƒäº®ç‚¹

### 1. åŠ¨æ€è¡¨å•é…ç½®ç³»ç»Ÿ

åç«¯é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶å‰ç«¯è¡¨å•ç»“æ„ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ /åˆ é™¤å­—æ®µï¼š

```typescript
// åç«¯é…ç½®ï¼ˆserver/src/configs/AdFormConfig.tsï¼‰
export const AdFormConfig = {
  fields: [
    {
      name: "title",
      label: "å¹¿å‘Šæ ‡é¢˜",
      type: "input",
      rules: [{ required: true, message: "è¯·è¾“å…¥å¹¿å‘Šæ ‡é¢˜" }],
    },
    {
      name: "videosInfo",
      label: "ä¸Šä¼ è§†é¢‘",
      type: "upload",
      component_props: {
        multiple: true,
        autoUpload: false,
      },
    },
    // ... æ›´å¤šå­—æ®µ
  ],
};
```

å‰ç«¯è‡ªåŠ¨æ¸²æŸ“è¡¨å•ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

### 2. æ•°æ®å¤„ç†ç®¡é“æ¨¡å¼

é€šè¿‡ Pipeline Pattern å¤„ç†ä¸åŒå­—æ®µç±»å‹çš„æ•°æ®è½¬æ¢ï¼š

```typescript
// æ–‡ä»¶ä¸Šä¼ å¤„ç†å™¨
const uploadProcessor: AdFormProcessor = async (values, config) => {
  // å°† File å¯¹è±¡è½¬æ¢ä¸º URL
  const uploadFields = config.filter((field) => field.type === "upload");
  for (const field of uploadFields) {
    const files = values[field.name];
    values[field.name] = await uploadFiles(files);
  }
  return values;
};

// åˆ›å»ºç®¡é“
const formProcessor = createPipeline(uploadProcessor, defaultProcessor);
```

### 3. å¹¿å‘Šç‚¹å‡»æµç¨‹æ§åˆ¶

åŸºäºé…ç½®çš„äº‹ä»¶æµå¤„ç†ï¼Œçµæ´»å¯æ‰©å±•ï¼š

```typescript
const CLICK_FLOW = ["video", "redirect", "count_up"] as const;

const actions = {
  video: async () => {
    /* æ’­æ”¾è§†é¢‘ */
  },
  redirect: async () => {
    /* è·³è½¬é¡µé¢ */
  },
  count_up: async () => {
    /* ç»Ÿè®¡ç‚¹å‡» */
  },
};

// è‡ªåŠ¨æ‰§è¡Œæµç¨‹
for (const step of CLICK_FLOW) {
  await actions[step]();
}
```

### 4. æ–‡ä»¶æ‰¹é‡ä¸Šä¼ ä¼˜åŒ–

å‡å°‘ç½‘ç»œè¯·æ±‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼š

```typescript
const uploadFileHelper = async (file: File) => {
  fileCache.push(file);

  // ç­–ç•¥1ï¼šæ–‡ä»¶æ•°è¾¾åˆ° 3 ä¸ªï¼Œç«‹å³ä¸Šä¼ 
  if (fileCache.length >= 3) {
    return await executeBatchUpload();
  }

  // ç­–ç•¥2ï¼š3 ç§’åä¸Šä¼ 
  setTimeout(() => executeBatchUpload(), 3000);
};
```

---

## ğŸ“Š æ ¸å¿ƒæµç¨‹

### å¹¿å‘Šç‚¹å‡»æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»å¹¿å‘Š
    â†“
æ’­æ”¾è§†é¢‘ï¼ˆéšæœºé€‰ä¸€ä¸ªï¼‰
    â†“
è§†é¢‘æ’­æ”¾å®Œæ¯•
    â†“
è·³è½¬è½åœ°é¡µ
    â†“
ç»Ÿè®¡ç‚¹å‡»é‡ï¼ˆ+1ï¼‰
```

### æ•°æ®æµè®¾è®¡

```
User Action â†’ Component â†’ Context â†’ API â†’ Backend â†’ Database
                â†‘                                        â†“
                â””â”€â”€â”€â”€â”€â”€â”€â”€ State Update â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- âœ… å°å‹å¹¿å‘ŠæŠ•æ”¾ç³»ç»Ÿ
- âœ… è§†é¢‘è¥é”€å¹³å°
- âœ… åŠ¨æ€è¡¨å•ç®¡ç†ç³»ç»Ÿ
- âœ… å‰åç«¯åˆ†ç¦»é¡¹ç›®å­¦ä¹ 

---

## ğŸ“ API æ–‡æ¡£

## ğŸ“ API æ¥å£æ–‡æ¡£

**Base URL**: `/v1/api`

**ç»Ÿä¸€å“åº”æ ¼å¼**:
```json
{
  "code": 0,
  "data": {},
  "message": "success"
}
```

---

### å¹¿å‘Šç®¡ç†æ¥å£

| æ¥å£è·¯å¾„            | è¯·æ±‚æ–¹æ³• | æ¥å£è¯´æ˜     | è¯·æ±‚å‚æ•°ç±»å‹          | è¯·æ±‚å‚æ•°ç¤ºä¾‹                                      | å“åº”æ•°æ®ç±»å‹            |
| ------------------- | -------- | ------------ | --------------------- | ------------------------------------------------- | ----------------------- |
| `/ads`              | `GET`    | è·å–æ‰€æœ‰å¹¿å‘Š | æ—                     | -                                                 | `AdvertisementMeta[]`   |
| `/create_ad`        | `POST`   | åˆ›å»ºå¹¿å‘Š     | `AdvertisementMeta`   | `{ title, publisher, content, ... }`              | `AdvertisementMeta`     |
| `/edit_ad`          | `POST`   | ç¼–è¾‘å¹¿å‘Š     | `AdvertisementMeta`   | `{ id, title, publisher, content, ... }`          | `AdvertisementMeta`     |
| `/delete_ad`        | `POST`   | åˆ é™¤å¹¿å‘Š     | `{ id: string }`      | `{ "id": "123456" }`                              | `-`                     |
| `/advertise/:id`    | `GET`    | è·å–å•ä¸ªå¹¿å‘Š | è·¯å¾„å‚æ•°              | `/advertise/123456`                               | `AdvertisementMeta`     |
| `/count_click`      | `POST`   | ç»Ÿè®¡ç‚¹å‡»é‡   | `{ id: string }`      | `{ "id": "123456" }`                              | `AdvertisementMeta`     |

---

### æ–‡ä»¶ä¸Šä¼ æ¥å£

| æ¥å£è·¯å¾„       | è¯·æ±‚æ–¹æ³• | æ¥å£è¯´æ˜     | è¯·æ±‚å‚æ•°ç±»å‹           | è¯·æ±‚å‚æ•°ç¤ºä¾‹          | å“åº”æ•°æ®ç±»å‹  |
| -------------- | -------- | ------------ | ---------------------- | --------------------- | ------------- |
| `/upload_file` | `POST`   | æ‰¹é‡ä¸Šä¼ è§†é¢‘ | `FormData` (å¤šæ–‡ä»¶)    | `video: File[]`       | `videosInfo[]`|

**è¯·æ±‚ç¤ºä¾‹**:
```typescript
const formData = new FormData();
formData.append('video', file1);
formData.append('video', file2);
```

---

### é…ç½®æ¥å£

| æ¥å£è·¯å¾„      | è¯·æ±‚æ–¹æ³• | æ¥å£è¯´æ˜       | è¯·æ±‚å‚æ•°ç±»å‹ | å“åº”æ•°æ®ç±»å‹       |
| ------------- | -------- | -------------- | ------------ | ------------------ |
| `/form_config`| `GET`    | è·å–è¡¨å•é…ç½®   | æ—            | `FormFieldConfig[]`|

---

### æ•°æ®ç±»å‹å®šä¹‰

**AdvertisementMeta**:
```typescript
interface AdvertisementMeta {
  id: string;                    // å¹¿å‘Šå”¯ä¸€æ ‡è¯†
  title: string;                 // å¹¿å‘Šæ ‡é¢˜
  publisher: string;             // å‘å¸ƒäºº
  content: string;               // å†…å®¹æ–‡æ¡ˆ
  redirectUrl: string;           // è½åœ°é¡µé“¾æ¥
  price: number;                 // å‡ºä»·ï¼ˆå…ƒï¼‰
  clickCount: number;            // ç‚¹å‡»æ¬¡æ•°
  videosInfo?: VideoInfo[];      // è§†é¢‘ä¿¡æ¯æ•°ç»„
}
```

**VideoInfo**:
```typescript
interface VideoInfo {
  url: string;      // è§†é¢‘è®¿é—®åœ°å€
  name: string;     // æ–‡ä»¶å
  uid: string;      // å”¯ä¸€æ ‡è¯†
}
```

**FormFieldConfig**:
```typescript
interface FormFieldConfig {
  name: string;                  // å­—æ®µå
  label: string;                 // å­—æ®µæ ‡ç­¾
  type: string;                  // å­—æ®µç±»å‹ï¼ˆinput/textarea/upload/numberï¼‰
  rules?: Array<{                // éªŒè¯è§„åˆ™
    required?: boolean;
    message?: string;
  }>;
  component_props?: object;      // ç»„ä»¶é¢å¤–å±æ€§
}
```

---

### é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜           | å¤„ç†å»ºè®®               |
| ------ | -------------- | ---------------------- |
| `0`    | è¯·æ±‚æˆåŠŸ       | -                      |
| `400`  | å‚æ•°é”™è¯¯       | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼       |
| `404`  | èµ„æºä¸å­˜åœ¨     | æ£€æŸ¥å¹¿å‘Š ID æ˜¯å¦æ­£ç¡®   |
| `500`  | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ           |

---

### è¯·æ±‚ç¤ºä¾‹

**åˆ›å»ºå¹¿å‘Š**:
```bash
curl -X POST http://localhost:3000/v1/api/create_ad \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æ–°å¹¿å‘Š",
    "publisher": "å¼ ä¸‰",
    "content": "è¿™æ˜¯å¹¿å‘Šå†…å®¹",
    "redirectUrl": "https://example.com",
    "price": 100,
    "videosInfo": [
      {
        "url": "https://example.com/video.mp4",
        "name": "video.mp4",
        "uid": "uid123"
      }
    ]
  }'
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "data": {
    "id": "1234567890",
    "title": "æ–°å¹¿å‘Š",
    "publisher": "å¼ ä¸‰",
    "content": "è¿™æ˜¯å¹¿å‘Šå†…å®¹",
    "redirectUrl": "https://example.com",
    "price": 100,
    "clickCount": 0,
    "videosInfo": [...]
  },
  "message": "åˆ›å»ºæˆåŠŸ"
}
```
---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆåç«¯ï¼‰ï¼š

```env
PORT=3000
UPLOAD_DIR=./public/videos
DB_PATH=./data/db.json
```

### è¡¨å•é…ç½®

ä¿®æ”¹ `server/src/configs/AdFormConfig.ts` å¯è‡ªå®šä¹‰è¡¨å•å­—æ®µã€‚

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](LICENSE) åè®®å¼€æºã€‚

---

## ğŸ‘¨â€ğŸ’» ä½œè€…

**jet-isnt-haha**

- GitHub: [@jet-isnt-haha](https://github.com/jet-isnt-haha)

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª â­ï¸ Starï¼**

</div>
